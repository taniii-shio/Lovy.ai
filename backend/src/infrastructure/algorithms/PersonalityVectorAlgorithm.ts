// =============== ② 性格ベクトル（Top3 抽出版） ===============

import { TypeFlags } from "./common/TypeFlags";
import { toS5 } from "./common/ScoreBuckets";
import {
  PersonalityAxis,
  PersonalityVectorItem,
  createPersonalityAxis,
} from "../../domain/valueObjects/PersonalityAxis";

//【採用テキスト】11軸 × S1〜S5 の辞書 (カジュアル全開・非重複)
const personalityTexts: Record<string, Record<string, string>> = {
  extraversion: { // 外向性
    S5: "超絶パリピ。エネルギー源は完全に人との交流。充電ケーブルが他人につながってるタイプ。",
    S4: "お祭り大好きマン。楽しいことがある場所に自然と吸い寄せられる。グループの起爆剤。",
    S3: "使い分けの達人。集団行動もソロ活もどっちもいける口。TPOに合わせてキャラ変可能。",
    S2: "気心知れた相手限定の陽キャ。知らない人がいると地蔵になるけど、仲間内ではうるさい。",
    S1: "静寂を愛する者。自分の部屋のベッドの上が世界の中心。人混みはガチでHP削られる。",
  },
  introversionDepth: { // 内面志向
    S5: "脳内宇宙人。頭の中は壮大な世界が広がってる。一度考え始めると、どこまでも深く潜っていく。",
    S4: "熟考のスペシャリスト。発言する前に脳内で100回シミュレーションしてる。だから言葉に重みがある。",
    S3: "バランス思考型。深く考えるけど、ちゃんと周りの意見も聞く。独りよがりにならない賢さがある。",
    S2: "直感センサー搭載。深く考えるより「ピンときた」を信じる。たまに大成功するギャンブラー。",
    S1: "体当たり精神の持ち主。「習うより慣れろ」が信条。考える前にまず行動、話はそれからだ。",
  },
  intuitionRomance: { // 直観／ロマン性
    S5: "ファンタジー世界の住人。現実より「こうだったら面白いな」で生きてる。夢を語らせたら止まらない。",
    S4: "アイデアの泉。普通の人には見えない「点と点の繋がり」が見える。企画とかさせたら天才。",
    S3: "現実と理想の翻訳家。ロマンも大事だけど、それをどう実現するかもちゃんと考えられる。",
    S2: "データ重視派。根拠のない話は信じない。「で、ソースは？」って聞いちゃうタイプ。",
    S1: "事実絶対主義者。目の前にあるものが全て。スピリチュアルな話とかマジで興味ない。",
  },
  realism: { // 現実／実務性
    S5: "人間エクセル。数字と事実で物事を判断するプロ。どんな状況でも最適な手順を叩き出す。",
    S4: "地に足つきすぎてる人。計画通りに着実に物事を進めるのが得意で、周りからの信頼が厚い。",
    S3: "理想と現実のハイブリッド。大きな目標も見るけど、そのための具体的なステップも考えられる。",
    S2: "ちょいフワフワしてる。細かいことより全体の雰囲気を重視するから、たまに足元すくわれがち。",
    S1: "雰囲気で生きてる。データや事実より、自分の「なんかそんな感じがする」を信じる天才。",
  },
  thinking: { // 論理性
    S5: "人間AI。感情を挟まず、常に最適解を求める。正論パンチが得意技で、議論では無敗。",
    S4: "冷静な分析官。問題が起きてもパニクらない。まず状況を整理して、最短ルートを導き出す。",
    S3: "頭脳と感情のハイブリッド。論理的に考えるけど、人の気持ちもちゃんと汲み取れるバランスタイプ。",
    S2: "理屈よりハート。「正しいか」より「好きか」で動く。人間味あふれる優しい人。",
    S1: "感覚派アーティスト。「なんかエモいから」が全ての判断基準。論理では説明不能な魅力がある。",
  },
  feeling: { // 共感性
    S5: "歩くカウンセリングルーム。人の感情の波を敏感に察知して、寄り添うのが超うまい。",
    S4: "平和の守護神。場の空気が悪くなるのを全力で阻止する。みんなの潤滑油的存在。",
    S3: "親しき仲にも礼儀あり。共感はするけど、ズカズカとテリトリーには踏み込まない絶妙な距離感。",
    S2: "サバサバ系。人の悩みには乗るけど、感情移入しすぎない。客観的なアドバイスが得意。",
    S1: "鋼のメンタル。「それはそれ、これはこれ」で割り切れる。他人の感情に振り回されない。",
  },
  structure: { // 構造化・計画性
    S5: "スケジュールの神。1ヶ月先の予定までGoogleカレンダーにびっしり。アドリブは敵。",
    S4: "ToDoリストの信者。タスクを完了させることに快感を覚える。常に何かを整理してる。",
    S3: "大枠だけ決める派。ゴールさえ見えてれば、道のりはその場のノリでOK。柔軟な計画者。",
    S2: "気分で動く自由人。「気が向いたらやる」が基本スタンスで、締め切り直前に覚醒する。",
    S1: "完全ノープラン人間。計画を立てること自体がストレス。その場の流れこそが最高の計画。",
  },
  flexibility: { // 柔軟・フットワーク
    S5: "変化対応の鬼。トラブルが起きると逆に燃えるタイプ。どんな無茶振りも笑顔でこなす。",
    S4: "臨機応変の達人。状況が変わっても「なるほどね」で即座に対応できる。ストレス耐性高め。",
    S3: "切り替え上手。計画通りに進めるのも、途中で変えるのもどっちもOK。バランス感覚がいい。",
    S2: "ルーティンが命。決まったやり方を変えるのが苦手。新しいことにはちょっと臆病。",
    S1: "超頑固者。「一度決めたことは絶対」という強い意志の持ち主。変化は最大の敵。",
  },
  cuddleNeed: { // 甘えニーズ
    S5: "超かまってちゃん。常に誰かの愛情を感じてないと枯渇する。LINEの返信は秒でほしい。",
    S4: "寂しがり屋のうさぎ。一人は嫌いじゃないけど、定期的に誰かに構ってもらわないとダメになる。",
    S3: "ツンデレ気質。甘えたいけど、素直になれない時もある。気分によって距離感が変わる。",
    S2: "自立心の塊。人に甘えるのはちょっと苦手。自分のことは自分でやりたいタイプ。",
    S1: "孤高のオオカミ。「ベタベタすんの無理」って思ってる。一人でいるのが一番ラク。",
  },
  acceptWarmth: { // 甘え受容力
    S5: "無限の包容力、もはや聖母。どんなワガママも「よしよし」って受け止める。人類のオアシス。",
    S4: "世話焼きお兄さん/お姉さん。人の面倒を見るのが好きで、頼られると嬉しくなっちゃう。",
    S3: "人による。心を許した相手ならとことん甘やかすけど、誰にでも優しいわけじゃない。",
    S2: "自分のことで手一杯。人に甘えられると、ちょっと「うっ…」ってなっちゃう。キャパは狭め。",
    S1: "「お互い頑張ろ」がモットー。人に頼るのも頼られるのも苦手。対等な関係が好き。",
  },
  leadAttitude: { // 主導性
    S5: "生まれながらの王様/女王様。「私についてきなさい」タイプで、自然と人がついてくるカリスマ。",
    S4: "学級委員長タイプ。みんなの意見をまとめつつ、最終的には自分が決断する仕切り屋。",
    S3: "縁の下の力持ち。前に出るのもいいけど、サポート役もこなせるバランサー。",
    S2: "平和が一番のサポーター。争い事は避けたいので、基本的には強い人についていく。",
    S1: "究極の受け身。「なんでもいいよ〜」が口癖で、決断は100%他人に委ねたい。",
  },
};

// 性格ベクトル計算（Top3 抽出）
export function calcPersonalityVector(flags: TypeFlags): PersonalityAxis {
  const { E, I, N, S, Fm, Tm, J, Pm, C, A, R, Pl, L } = flags;

  const axes: PersonalityVectorItem[] = [
    { key: "extraversion", label: "外向性", score: E * 100, level: "", text: "" },
    { key: "introversionDepth", label: "内面志向", score: I * 100, level: "", text: "" },
    { key: "intuitionRomance", label: "直観／ロマン性", score: (0.7 * N + 0.3 * Pl) * 100, level: "", text: "" },
    { key: "realism", label: "現実／実務性", score: (0.7 * S + 0.3 * R) * 100, level: "", text: "" },
    { key: "thinking", label: "論理性", score: Tm * 100, level: "", text: "" },
    { key: "feeling", label: "共感性", score: Fm * 100, level: "", text: "" },
    { key: "structure", label: "構造化・計画性", score: J * 100, level: "", text: "" },
    { key: "flexibility", label: "柔軟・フットワーク", score: Pm * 100, level: "", text: "" },
    { key: "cuddleNeed", label: "甘えニーズ", score: C * 100, level: "", text: "" },
    { key: "acceptWarmth", label: "甘え受容力", score: A * 100, level: "", text: "" },
    { key: "leadAttitude", label: "主導性", score: L * 100, level: "", text: "" },
  ];

  // 各軸にレベルとテキストを付与
  axes.forEach(axis => {
    const level = toS5(axis.score);
    axis.level = level;
    axis.text = personalityTexts[axis.key][level];
  });

  // スコア降順でソートし、上位3つを抽出
  const sorted = [...axes].sort((a, b) => b.score - a.score);
  const top3 = sorted.slice(0, 3);

  return createPersonalityAxis(top3, axes);
}
