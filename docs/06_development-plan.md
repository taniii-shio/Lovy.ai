# 開発計画

## 1. 開発フェーズ

### Phase 1: 基盤構築 (Week 1-2)

- [ ] プロジェクト初期セットアップ
  - [ ] バックエンド: Serverless Framework 設定
  - [ ] フロントエンド: Vite + React + TypeScript 環境構築
  - [ ] DDD/オニオンアーキテクチャのディレクトリ構造作成

### Phase 2: ドメインロジック実装 (Week 3-4)

- [ ] ドメイン層の実装
  - [ ] エンティティ定義（DiagnosisResult, MBTIType, LoveType）
  - [ ] 値オブジェクト定義（PopularityScore, Compatibility 等）
- [ ] 5 つの診断アルゴリズム実装
  - [ ] 1. モテ度スコアリングアルゴリズム
  - [ ] 2. 性格テキスト生成ロジック
  - [ ] 3. 相性マッチングアルゴリズム
  - [ ] 4. 愛着表現優先順位アルゴリズム
  - [ ] 5. 時間配分計算アルゴリズム
- [ ] ユニットテスト作成（各アルゴリズム）

### Phase 3: API 実装 (Week 5-6)

- [ ] アプリケーション層
  - [ ] ExecuteDiagnosisUseCase 実装（ステートレス）
  - [ ] DTO 定義（DiagnosisInput, DiagnosisOutput）
- [ ] インフラ層
  - [ ] 5 つのアルゴリズム実装詳細
- [ ] インターフェース層
  - [ ] Lambda ハンドラー実装
    - `POST /api/v1/diagnosis` - 診断実行（必須）
  - [ ] 入力バリデーション実装（MBTI, LoveType）
- [ ] API 統合テスト

### Phase 4: フロントエンド実装 (Week 7-8)

- [ ] UI/UX デザイン
  - [ ] ワイヤーフレーム作成
  - [ ] デザインシステム構築（Tailwind CSS）
  - [ ] 結果画像デザイン（OGP 対応）
- [ ] ページ実装
  - [ ] ランディングページ
  - [ ] MBTI 選択画面（16 パターンから選択）
  - [ ] Love Type 16 選択画面（16 パターンから選択）
  - [ ] 診断結果表示画面
    - モテ度表示
    - 性格テキスト表示
    - 相性ベスト 3 表示
    - 愛着表現ランキング表示
    - 時間配分グラフ表示
- [ ] **結果サマリ画像生成・ダウンロード機能（優先）**
  - [ ] html2canvas で画像生成
  - [ ] 画像ダウンロード機能実装
  - [ ] デザインの最適化（SNS 映え）
- [ ] SNS 共有機能実装（Nice to Have）
  - [ ] Twitter 共有ボタン
  - [ ] LINE 共有ボタン
  - [ ] Instagram 用の画像最適化

### Phase 5: 統合・テスト (Week 9-10)

- [ ] E2E テスト（Playwright 等）
- [ ] パフォーマンステスト
  - [ ] Lambda Cold Start 対策
  - [ ] 画像生成速度の最適化
- [ ] セキュリティテスト
  - [ ] 入力バリデーション確認
  - [ ] XSS 対策確認
- [ ] クロスブラウザテスト
- [ ] モバイル対応確認（レスポンシブ）

### Phase 6: デプロイ・リリース (Week 11-12)

- [ ] 本番環境デプロイ
- [ ] CloudFront 設定（フロントエンド配信）
- [ ] ドメイン設定・SSL 証明書（Route53 + ACM）
- [ ] モニタリング設定
  - [ ] CloudWatch Logs
  - [ ] CloudWatch Metrics（Lambda, API Gateway）
  - [ ] アラーム設定（エラー率、レスポンスタイム）
- [ ] ソフトローンチ（限定公開テスト）
- [ ] フィードバック収集・改善
- [ ] 正式リリース

---

## 2. 優先順位

### Must Have (MVP)

1. ✅ 診断機能（5 つのアルゴリズム）- ステートレス実装
2. ✅ 結果表示画面
3. ✅ **結果サマリ画像エクスポート・ダウンロード機能**
4. ✅ 基本的な UI/UX
5. ✅ レスポンシブデザイン

### Nice to Have（初期リリース）

1. SNS 共有機能（Twitter, LINE, Instagram）
   - 時間があれば実装
   - バイラル拡散に有効
2. 画像の一時 S3 保存（共有用 URL 生成）

### Should Have（将来）

1. 画像の自動削除（TTL）- S3 実装時
2. 診断結果の統計表示

### Could Have (将来的に)

1. 診断結果の保存・再表示 → **DynamoDB 導入時**
2. ユーザー登録・ログイン
3. 診断履歴管理
4. 統計データの可視化（人気の組み合わせ等）
5. 有料診断プラン
6. 多言語対応

### Won't Have (初期リリース)

- ❌ DynamoDB（診断結果を永続化しない）
- ❌ ユーザー認証
- ❌ 診断結果の長期保存

---

## 3. リスクと対策

| リスク                 | 影響度 | 対策                                     |
| ---------------------- | ------ | ---------------------------------------- |
| アルゴリズムの精度不足 | 高     | 専門家レビュー、ユーザーテスト           |
| Lambda Cold Start      | 中     | Provisioned Concurrency、軽量化          |
| 画像生成の遅延         | 中     | クライアント生成優先、バックエンドは補助 |
| S3 ストレージコスト    | 低     | 48 時間 TTL で自動削除                   |
| スケーラビリティ       | 低     | ステートレス設計により自動スケール可能   |
| セキュリティ脆弱性     | 高     | 入力バリデーション、レート制限           |

---

## 4. 成功指標（KPI）

### フェーズ 1（リリース後 1 ヶ月）

- 診断完了数: 1,000 回
- **画像ダウンロード率: 50%以上**（診断完了者のうち）
- 画像生成成功率: > 95%
- エラー率: < 1%
- 平均レスポンスタイム: < 2 秒
- SNS シェア率: 10%以上（実装した場合）

### フェーズ 2（リリース後 3 ヶ月）

- 診断完了数: 10,000 回
- 画像ダウンロード率: 60%以上
- SNS シェア率: 30%（本格実装後）
- バイラル係数: > 1.2
- ユーザー満足度: 4.0/5.0 以上

---

## 5. インフラコスト試算（初期）

### AWS 利用料（月間 1 万診断想定 - 初期リリース）

| サービス    | 使用量                                | 概算コスト    |
| ----------- | ------------------------------------- | ------------- |
| Lambda      | 10,000 リクエスト × 1 秒実行          | ~$0.20        |
| API Gateway | 10,000 リクエスト                     | ~$0.04        |
| S3          | 静的ファイルホスティング（React App） | ~$0.50        |
| CloudFront  | データ転送（フロントエンド配信）      | ~$3.00        |
| Route53     | ホストゾーン                          | $0.50         |
| **合計**    |                                       | **~$4.50/月** |

---

## 6. 次のアクション

### 優先度: 高

1. **Love Type 16 の 4 軸の意味を具体的に定義**

   - L/F 軸の意味（例: Logical / Feeling）
   - C/A 軸の意味（例: Cautious / Adventurous）
   - R/P 軸の意味（例: Rational / Passionate）
   - O/E 軸の意味（例: Open / Exclusive）
   - 心理学的根拠の調査
   - 16 パターンの命名（タイプ名）

2. **256 通りのアルゴリズムロジック詳細化**

   - スプレッドシートで相性マトリクス作成
   - 性格テキストのテンプレート作成（最低限のパターン）
   - モテ度スコアの重み付け定義

3. **デザインモックアップ作成**
   - Figma 等でプロトタイプ
   - 結果画像のデザイン（SNS 映えするビジュアル）

### 優先度: 中

4. **開発環境のセットアップ**

   - backend ディレクトリの初期化
   - frontend ディレクトリの初期化
   - serverless.yml の作成

5. **静的データの準備方針決定**
   - JSON/YAML/TypeScript 定数のどれで管理するか
   - データの更新フローの検討

---

## 7. 技術的決定事項

### 確定事項

- ✅ フロントエンド: React + TypeScript + Vite
- ✅ バックエンド: TypeScript + Serverless Framework
- ✅ インフラ: AWS Lambda + API Gateway + S3 + CloudFront
- ✅ アーキテクチャ: DDD + オニオンアーキテクチャ
- ✅ **診断結果は永続化しない（ステートレス）**
- ✅ **DynamoDB は初期リリースで使用しない**
- ✅ **Love Type 16 の 4 軸定義: L/F + C/A + R/P + O/E**
- ✅ **入力方式: MBTI（16 パターン）と Love Type 16（16 パターン）を選択**

### 検討中

- 画像生成: クライアント（html2canvas）vs サーバー（Puppeteer）
- 静的データの管理方法: JSON vs TypeScript 定数
- Love Type 16 の各軸の具体的な意味定義
